<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>昭和横濱物語</title>

  <!-- https://fonts.google.com/ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic&family=BIZ+UDPMincho&family=Share+Tech&family=VT323&display=swap" rel="stylesheet">

  <link href="demeter.css" rel="stylesheet">
  <link href="demeter-font.css" rel="stylesheet">

  <link href="manifest.webmanifest" rel="manifest">
  <link href="favicon.ico" rel="icon" sizes="any">
  <link href="favicon.svg" rel="icon" type="image/svg+xml">
  <link href="apple-touch-icon.png" rel="apple-touch-icon">

  <script defer src="demeter.js"></script>
  <script defer src="demeter-jlreq.js"></script>
</head>
<body>
<div id="loader" style="overflow-wrap: break-word"></div>

<template id="template">
<div>………………………………………………………………<ruby>聖堂<rt>カテドラル</rt></ruby>………………………………………………………………<br><ruby>本文<rt>ながいながいルビ</rt></ruby>あいうえおかきくけこさしすせそ<ruby>本文<rt>ながいながいルビ</rt></ruby>たちつてと。<ruby>本文<rt>ながいながいルビ</rt></ruby>なにぬねの。<ruby>ながいながいながいながいながい本文<rt>ながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいルビ</rt></ruby>たちつてと。<br><ruby>ながい本文<rt>ルビ</rt></ruby>あいうえおかきくけこさしすせそ<ruby>ながい本文<rt>ルビ</rt></ruby>たちつてと。<br><ruby>親文字<rt>TaTiTuTeTo TaTiTuTe</rt></ruby>。</div>


<!--
<div>………………………………………………………………<ruby>聖堂<rt>カテドラル</rt></ruby>………………………………………………………………<br><ruby>本文<rt>ながいながいルビ</rt></ruby>あいうえおかきくけこさしすせそ<ruby>本文<rt>ながいながいルビ</rt></ruby>たちつてと。<ruby>本文<rt>ながいながいルビ</rt></ruby>なにぬねの。<ruby>ながいながいながいながいながい本文<rt>ながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいルビ</rt></ruby>たちつてと。<br><ruby>ながい本文<rt>ルビ</rt></ruby>あいうえおかきくけこさしすせそ<ruby>ながい本文<rt>ルビ</rt></ruby>たちつてと。<br><ruby>親文字<rt>TaTiTuTeTo TaTiTuTe</rt></ruby>。</div>

<div>………………………………………………………………<ruby>聖堂<rt>カテドラル</rt></ruby>………………………………………………………………<br><ruby>本文<rt>ながいながいルビ</rt></ruby>あいうえおかきくけこさしすせそ<ruby>本文<rt>ながいながいルビ</rt></ruby>たちつてと。<ruby>本文<rt>ながいながいルビ</rt></ruby>なにぬねの。<ruby>ながいながいながいながいながい本文<rt>ながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいルビ</rt></ruby>たちつてと。<br><ruby>ながい本文<rt>ルビ</rt></ruby>あいうえおかきくけこさしすせそ<ruby>ながい本文<rt>ルビ</rt></ruby>たちつてと。<br>TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo<br>TaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeTo<br><span>TaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeTo<br><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><br><span>TaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeTo</span><br><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><br><ruby>親文字<rt>TaTiTuTeTo TaTiTuTe</rt></ruby>。</div>

<div><ruby>本文<rt>ながいながいルビ</rt></ruby>あいうえおかきくけこさしすせそ<ruby>本文<rt>ながいながいルビ</rt></ruby>たちつてと。<ruby>本文<rt>ながいながいルビ</rt></ruby>なにぬねの。<ruby>ながいながいながいながいながい本文<rt>ながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいながいルビ</rt></ruby>たちつてと。<br><ruby>ながい本文<rt>ルビ</rt></ruby>あいうえおかきくけこさしすせそ<ruby>ながい本文<rt>ルビ</rt></ruby>たちつてと。</div>

<div>TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo TaTiTuTeTo </div>

<div>TaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeTo</div>

<div><span>TaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeTo<br><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span></div>

<div><span>TaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeToTaTiTuTeTo</span><br><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span><span>Ta</span><span>Ti</span><span>Tu</span><span>Te</span><span>To</span></div>

<div><ruby>親文字<rt>TaTiTuTeTo TaTiTuTeTo</rt></ruby>。</div>

-->
</template>

<div id="output" style="
  width: 478px;
  height: 576px;
  font-family: 'Showa Yokohama Story', 'Share Tech', 'BIZ UDPMincho';
  font-size: 24px;
  overflow: hidden;
  resize: both;
"></div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  let start;

  const D = globalThis.demeter;
  await D.boot();

  const loader = document.getElementById("loader");

  const result = await D.loadFontFaces(30000);
  const template = document.createElement("template");
  template.innerHTML =`
    <div>status: ${D.escapeHtml(result.status)}</div>
    <div>elapsed: ${result.elapsed}</div>
  `;
  loader.append(template.content);

  const output = document.getElementById("output");

  let prevWidth;
  const update = (width) => {
    if (prevWidth === width) {
      return;
    }
    start = performance.now();
    const paragraph = D.parseParagraph(document.getElementById("template").content.firstElementChild, 24, "'Showa Yokohama Story', 'Share Tech', 'BIZ UDPMincho'");
    const lines = paragraph.map(text => D.composeText(text, width)).flat();
    output.replaceChildren(D.layoutText(lines, 24, 48));
    console.log("update", width, performance.now() - start);
    console.log(lines);
  };

  update(output.getBoundingClientRect().width);

  const observer = new ResizeObserver(entries => {
    entries.forEach(entry => {
      if (entry.target === output) {
        // console.log(entry.contentBoxSize);
        update(entry.contentBoxSize[0].inlineSize);
      }
    });
  });
  observer.observe(output);


});
</script>
</body>
</html>
