<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>昭和横濱物語</title>

  <!-- https://fonts.google.com/ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic&family=Share+Tech&display=swap" rel="stylesheet">

  <link href="demeter.css" rel="stylesheet">
  <link href="demeter-font.css" rel="stylesheet">

  <link href="manifest.webmanifest" rel="manifest">
  <link href="favicon.ico" rel="icon" sizes="any">
  <link href="favicon.svg" rel="icon" type="image/svg+xml">
  <link href="apple-touch-icon.png" rel="apple-touch-icon">

  <!-- https://github.com/tweenjs/tween.js/#installation -->
  <script defer src="https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.umd.js" integrity="sha256-2xE/Od+yrQ9FR3LZzqk1yNM0880syyumHSG+6fYJF6U=" crossorigin="anonymous"></script>

  <script defer src="demeter.js"></script>
  <script defer src="demeter-jlreq.js"></script>

  <style>
    .button {
      width: 480px;
      background-color: #000;
      margin: 0 0 24px 0;
      padding: 12px 36px;
      border: 1px solid #029D93;
      border-radius: 36px 0;
      cursor: pointer;
      transition: all 1s;
    }

    .button:hover {
      border-radius: 0;
    }

    .button:active {
      background-color: #029D93;
      /* border-color: #E00; */
    }
  </style>
</head>

<body style="
  margin: 0 0 0 24px;
  background-color: #000;
  color: #FFF;
">

<div id="source" style="
  /* display: none; */
  font-size: 24px;
  font-family: 'Showa Yokohama Story', 'Share Tech', 'BIZ UDPGothic', sans-serif;
  line-height: 2;
">
<button><div>エデンの<ruby>園<rt>その</rt></ruby></div></button>
<button><div>グライダー<ruby>銃<rt>ガン</rt></ruby></div></button>
</div>

<div>
  <svg viewBox="0 0 600 120" style="width: 600px; height: 120px">
    <!--
    <rect x="24" y="24" width="480" height="72" style="fill: rgba(255,255,255,0.25)"/>
    -->

    <path style="fill: rgba(255,255,255,0.25); stroke: none" d="
      M 30,30
      h 468
      v 60
      h -447
      l -21,-21
      z
    "/>

    <path style="fill: rgba(255,255,255,0.25); stroke: none" d="
      M 24,81
      h 3
      l 12,12
      v 3
      h -12
      l -3,-3
      z
    "/>

    <path style="fill: none; stroke: rgba(255,255,255,1); stroke-width: 1px" d="
      M 24,24
      h 480
      v 72
      h -456
      l -24,-24
      z
    "/>
    <path style="fill: rgba(255,255,255,1); stroke: rgba(255,255,255,1); stroke-width: 1px" d="
      M 24,24
      v -3
      l 3, -3
      h 114
      l 3, 3
      h 240
      l 3, -3
      h 114
      l 3, 3
      v 3
      z
    "/>
  </svg>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const D = globalThis.demeter;
  await D.boot();

  const start = performance.now();
  const result = await D.loadFontFaces(10000);
  console.log("loadFontFaces", performance.now() - start, result);

  const fontSize = 24;
  const font = "'Showa Yokohama Story', 'Share Tech', 'BIZ UDPGothic', sans-serif";

  const outputNode = document.body.appendChild(document.createElement("div"));
  outputNode.style.font = D.numberToCssPixels(fontSize) + " " + font;

  const sourceNodes = document.querySelector("#source").children;
  for (let i = 0; i < sourceNodes.length; ++i) {
    const sourceNode = sourceNodes[i];
    const paragraph = D.parseParagraph(sourceNode, fontSize, font);
    paragraph.forEach(text => {
      const lines = D.composeText(text, 480);
      const textNode = D.layoutText(lines, fontSize, fontSize * 2);
      console.log(textNode);
      const linkNode = document.createElement("div");
      linkNode.className = "button";
      linkNode.append(textNode);
      outputNode.append(linkNode);




    });
  }

  while (true) {
    const t = await D.requestAnimationFrame();
    TWEEN.update();

  }

});
</script>

</body>
</html>
